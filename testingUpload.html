<!DOCTYPE html>
<html>
  <head>
    <title>Azure Blob Storage Upload Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@azure/identity"></script>
    <script src="https://cdn.jsdelivr.net/npm/@azure/storage-blob"></script>
  </head>
  <body>
    <button id="upload-button">Upload JSON to Blob Storage</button>
    <script>
      const { DefaultAzureCredential } = AzureIdentity;
      const { BlobServiceClient } = AzureStorageBlob;

      async function uploadJsonToBlobStorage(account, containerName, blobName, jsonData) {
        // Create a DefaultAzureCredential to authenticate with a managed identity
        const credential = new DefaultAzureCredential();

        // Create a BlobServiceClient object to interact with Azure Blob Storage
        const blobServiceClient = new BlobServiceClient(
          `https://${account}.blob.core.windows.net`,
          credential
        );

        // Get a reference to a container
        const containerClient = blobServiceClient.getContainerClient(containerName);

        // Create a block blob
        const blockBlobClient = containerClient.getBlockBlobClient(blobName);

        // Upload data to the blob
        const uploadBlobResponse = await blockBlobClient.upload(
          JSON.stringify(jsonData),
          Buffer.byteLength(JSON.stringify(jsonData))
        );
        console.log(`Upload block blob ${blobName} successfully`, uploadBlobResponse.requestId);
      }

      document.getElementById('upload-button').addEventListener('click', () => {
        // Example usage
        const account = 'process.env.STORAGE_ACCOUNT_NAME';
        const containerName = 'process.env.BLOB_CONTAINER_NAME';
        const blobName = 'gregtesting.json';
        const jsonData = { key1: 'value1', key2: 'value2' };

        uploadJsonToBlobStorage(account, containerName, blobName, jsonData);
      });
    </script>
  </body>
</html>

